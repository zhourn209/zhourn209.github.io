<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„äº‘ç«¯ä¾¿ç­¾</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacFont,Segoe UI,Roboto}
body{background:#f2f5f8;padding:20px;display:flex;flex-direction:column;align-items:center;min-height:100vh}
.header{margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.page-btn{padding:10px 16px;border:none;border-radius:12px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer;font-size:16px}
.page-btn.active{background:#5191ff;color:#fff}
.sync-btn{background:#4e9a6d;color:#fff;padding:10px 16px;border:none;border-radius:12px;cursor:pointer;font-size:16px}
.editor{width:100%;max-width:600px;background:#fff;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.08);padding:20px}
textarea{width:100%;height:400px;border:none;outline:none;resize:none;font-size:16px;line-height:1.6}
.status{margin-top:10px;font-size:14px;color:#333;text-align:center}
#token{padding:8px 12px;width:320px;border-radius:8px;border:1px solid #ddd;margin-bottom:10px}
</style>
</head>
<body>

<div class="header">
  <button class="page-btn active" data-page="1">ç¬¬1é¡µ</button>
  <button class="page-btn" data-page="2">ç¬¬2é¡µ</button>
  <button class="page-btn" data-page="3">ç¬¬3é¡µ</button>
  <button class="sync-btn">â˜ï¸ åŒæ­¥åˆ°GitHub</button>
</div>

<input id="token" placeholder="ç²˜è´´ä½ çš„ GitHub Token">
<div class="editor">
  <textarea id="note" placeholder="å†™ä¾¿ç­¾ï¼Œç‚¹åŒæ­¥å°±èƒ½å¤šè®¾å¤‡åŒæ­¥"></textarea>
</div>
<div class="status" id="status">è¯·è¾“å…¥ Token åç‚¹åŒæ­¥</div>

<script>
// æˆ‘å·²ç»å¸®ä½ å¡«å¯¹ï¼šä½ çš„çœŸå®ä»“åº“
const CONFIG = {
  owner: 'zhourn209',
  repo: 'zhourn209.github.io',
  path: 'note/data.json'
}

let currentPage = 1
let pages = {1: '', 2: '', 3: ''}
const textarea = document.getElementById('note')
const status = document.getElementById('status')
const tokenInput = document.getElementById('token')

loadLocal()
render()

document.querySelectorAll('.page-btn:not(.sync-btn)').forEach(btn => {
  btn.addEventListener('click', () => {
    pages[currentPage] = textarea.value
    currentPage = btn.dataset.page
    render()
  })
})

document.querySelector('.sync-btn').addEventListener('click', syncToGitHub)
textarea.addEventListener('input', () => {
  pages[currentPage] = textarea.value
  saveLocal()
})

function render() {
  textarea.value = pages[currentPage] || ''
  document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'))
  document.querySelector(`.page-btn[data-page="${currentPage}"]`).classList.add('active')
}

function saveLocal() {
  localStorage.setItem('notes', JSON.stringify(pages))
}

function loadLocal() {
  const data = localStorage.getItem('notes')
  if (data) pages = JSON.parse(data)
}

async function syncToGitHub() {
  const token = tokenInput.value.trim()
  if (!token) {
    status.textContent = 'è¯·è¾“å…¥ Token'
    return
  }
  status.textContent = 'æ­£åœ¨åŒæ­¥...'

  try {
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(pages, null, 2))))
    let sha = ''

    const getRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
      headers: { Authorization: `token ${token}` }
    })

    if (getRes.ok) {
      const data = await getRes.json()
      sha = data.sha
    }

    const uploadRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: 'ğŸ’¾ åŒæ­¥ä¾¿ç­¾',
        content: content,
        sha: sha || undefined
      })
    })

    if (uploadRes.ok) {
      status.textContent = 'âœ… åŒæ­¥æˆåŠŸï¼æ•°æ®å­˜åœ¨ä½ çš„ GitHub é‡Œ'
    } else {
      status.textContent = 'âŒ åŒæ­¥å¤±è´¥ï¼šToken æˆ–æƒé™ä¸å¯¹'
    }
  } catch (e) {
    status.textContent = 'âŒ ç½‘ç»œé”™è¯¯'
  }
}
</script>
</body>
</html>
