<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„äº‘ç«¯ä¾¿ç­¾ï¼ˆGitHubåŒæ­¥ï¼‰</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacFont,Segoe UI,Roboto}
body{background:#f7f8fa;padding:20px;display:flex;flex-direction:column;align-items:center;min-height:100vh}
.header{margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.page-btn{padding:10px 16px;border:none;border-radius:12px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer;font-size:16px}
.page-btn.active{background:#5191ff;color:#fff}
.sync-btn{background:#4e9a6d;color:#fff}
.editor{width:100%;max-width:600px;background:#fff;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.08);padding:20px}
textarea{width:100%;height:400px;border:none;outline:none;resize:none;font-size:16px;line-height:1.6}
.status{margin-top:10px;font-size:14px;color:#666;text-align:center}
input{padding:8px;width:300px;border-radius:8px;border:1px solid #ddd;margin-bottom:10px}
</style>
</head>
<body>

<div class="header">
  <button class="page-btn active" data-page="1">ç¬¬1é¡µ</button>
  <button class="page-btn" data-page="2">ç¬¬2é¡µ</button>
  <button class="page-btn" data-page="3">ç¬¬3é¡µ</button>
  <button class="page-btn sync-btn">ğŸ“¤ ä¿å­˜åˆ°äº‘ç«¯</button>
</div>

<input id="token" placeholder="åœ¨è¿™é‡Œå¡«ä½ çš„GitHub Token">
<div class="editor">
  <textarea id="note" placeholder="ä¾¿ç­¾å†…å®¹ä¼šåŒæ­¥åˆ°ä½ çš„GitHubâ€¦"></textarea>
</div>
<div class="status" id="status">å‡†å¤‡å°±ç»ª</div>

<script>
const owner = "zhourn";
const repo = "zhourn.github.io";
const path = "note/data.json";

let currentPage = 1;
let pages = {1:"", 2:"", 3:""};

const textarea = document.getElementById("note");
const status = document.getElementById("status");
const tokenInput = document.getElementById("token");

loadLocal();
render();

document.querySelectorAll(".page-btn:not(.sync-btn)").forEach(btn => {
  btn.addEventListener("click", () => {
    pages[currentPage] = textarea.value;
    currentPage = btn.dataset.page;
    render();
  });
});

document.querySelector(".sync-btn").addEventListener("click", saveToGitHub);
textarea.addEventListener("input", () => {
  pages[currentPage] = textarea.value;
  saveLocal();
});

function render() {
  textarea.value = pages[currentPage] || "";
  document.querySelectorAll(".page-btn").forEach(b => b.classList.remove("active"));
  document.querySelector(`.page-btn[data-page="${currentPage}"]`).classList.add("active");
}

function saveLocal() {
  localStorage.setItem("mynotes", JSON.stringify(pages));
}

function loadLocal() {
  const data = localStorage.getItem("mynotes");
  if (data) pages = JSON.parse(data);
}

async function saveToGitHub() {
  const token = tokenInput.value.trim();
  if (!token) {
    status.textContent = "è¯·è¾“å…¥GitHub Token";
    return;
  }
  status.textContent = "åŒæ­¥ä¸­â€¦";

  const content = btoa(unescape(encodeURIComponent(JSON.stringify(pages, null, 2))));
  let sha = "";

  try {
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      headers: { Authorization: `token ${token}` }
    });
    if (res.ok) {
      const data = await res.json();
      sha = data.sha;
    }
  } catch (e) {}

  try {
    const resp = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "æ›´æ–°ä¾¿ç­¾",
        content: content,
        sha: sha || undefined
      })
    });

    if (resp.ok) {
      status.textContent = "âœ… å·²æˆåŠŸåŒæ­¥åˆ°ä½ çš„ GitHub äº‘ç«¯ï¼";
    } else {
      status.textContent = "âŒ åŒæ­¥å¤±è´¥ï¼Œæ£€æŸ¥Token";
    }
  } catch (e) {
    status.textContent = "âŒ ç½‘ç»œé”™è¯¯";
  }
}

async function loadFromGitHub() {
  const token = tokenInput.value.trim();
  if (!token) return;
  try {
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      headers: { Authorization: `token ${token}` }
    });
    const data = await res.json();
    const decoded = decodeURIComponent(escape(atob(data.content)));
    pages = JSON.parse(decoded);
    render();
    status.textContent = "âœ… ä»äº‘ç«¯åŠ è½½æˆåŠŸ";
  } catch (e) {}
}
</script>
</body>
</html>
